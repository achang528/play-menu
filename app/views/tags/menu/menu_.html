<ul class="_menu_list">
#{if _show_label && _menu_label}
<li class='_menu_label'><span>${messages.get(_menu_label)}</span></li>
#{/if}
#{list items: _menu_top_list, as: 'mi'}
	%{
		def showByContext = _menu_context == null || _menu_context.equalsIgnoreCase(mi.context)
		def showBylabel = mi.hasLabel(_menu_label)
		def showGlobal = !_menu_no_global && mi.hasLabel('_global')
		def showMenu = showGlobal || showByContext && showBylabel
		def url = play.modules.menu.MenuPlugin.url(mi)
	}%
	#{if _menu_debug}
		<br/>
		<b>${mi}</b> <br/>
		_menu_no_global: ${_menu_no_global} <br/>
	    _menu_context: ${_menu_context} </br>
		tg_global: ${mi.hasLabel('_global')} <br/>
		showGlobal: ${showGlobal} <br/>
		showByContext: ${showByContext} <br/>
		showBylabel: ${showBylabel} <br/>
		showMenu: ${showMenu} <br/>
		isCurrent: ${url?.endsWith(_menu_current?.split('\\?')[0])}<br/>
	#{/if}
	#{if showMenu}
		%{
      def cls = mi.cssClass ? mi.cssClass + " " : ""
		  if (url) {
        url = url.split('\\?')[0]
        def isCur = url.endsWith(_menu_current?.split('\\?')[0])
        cls+=isCur?"_menu_current":"";
		  }
      cls+=mi.subMenus.size()>0?" _menu_expanded":""
      def clsStr = "class='"+cls+"'"        
		}%
		<li id='_mi_${mi.name}' ${clsStr}>
			#{if url != null && !isCur}
				<a href="${url}" #{if mi.title != null}title="${messages.get(mi.title)}"#{/if}>
			#{/if}
			<span>${messages.get(mi.name)}</span>
			#{if url != null && !isCur}
				</a>
			#{/if}
			#{if mi.subMenus.size() > 0}
				#{menu.menu_ menu_top_list:mi.subMenus, menu_current: _menu_current, menu_context: _menu_context, menu_label: _menu_label, menu_no_global: _menu_no_global/}
			#{/if}
		</li>
	#{/if}
#{/list}
</ul>
